---
- name: Make sure kitty repo exist
  file:
    path: "{{ kitty_repos }}"
    state: directory

- name: Make sure local bin exist
  file:
    path: "{{ local_bin }}"
    state: directory

- name: Download the kitty
  get_url:
    url: https://sw.kovidgoyal.net/kitty/installer.sh
    dest: "{{ kitty_installer }}"
    mode: 0755

- name: Make sure some system dependencies are installed
  become: true
  package:
    name: "{{ item }}"
    state: 'present'
  with_items:
    - python3
    - python3-dev
    - tar
    - xz-utils

- name: Install kitty
  shell:
    creates: "{{ kitty_bin }}"
    cmd: |
      {{ kitty_installer }} \
        dest={{ kitty_repos }} \
        launch=n

- name: Symlink the kitty bin
  file:
    path: "{{ kitty_bin_linked }}"
    src: "{{ kitty_bin }}"
    state: link
